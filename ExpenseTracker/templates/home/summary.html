{% extends 'home/base.html' %}
{% load static %}

{% block title %}Expense Tracker - History{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href="{% static 'home.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'addmoney.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="mt-4">Summary Report </h1><br>
   
                </div>
        <div class="row">
        <div class="col-lg-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-pie mr-1"></i>
                   Chart
                </div>
                <div class="container"style="width:100%;">
                <div class="card-body"><canvas id="budgetChart" width="400" height="300"></canvas></div>
            </div>
            </div>
            </div>
            <div class="col-lg-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-chart-pie mr-1"></i>
                    DataTable
                </div>
                <div class="card-body">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Total Expense</th>
                                <th>Budget Limit</th>
                                <th>Remaining Budget</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for summary in category_summaries %}
                            <tr>
                                <td>{{ summary.category.name }}</td>
                                <td>{{ summary.total_expense }}</td>
                                <td>{{ summary.budget_limit }}</td>
                                <td>
{% if summary.remaining_budget < 0 %}
<div class="negative-budget">{{ summary.remaining_budget }}</div>
{% elif summary.remaining_budget > 0 %}
<div class="positive-budget">{{ summary.remaining_budget }}</div>
{% else %}
<!-- No special styling for zero remaining budget -->
{{ summary.remaining_budget }}
{% endif %}
</td>
                                <!-- <td style="width: 250px; height: 20px;">
                                    <canvas id="budgetChart_{{ forloop.counter }}" width="100" height="80"></canvas>
                                </td> -->
                               
                                <!-- <td>
                                    {% if summary.remaining_budget < 0 %}
                                        Budget Exceeded
                                    {% else %}
                                        {{ summary.remaining_budget }}
                                    {% endif %}
                                </td> -->
                            {% endfor %}
                        </tbody>
                    </table>
        </div>
    </div>
</div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Data for Charts
    var categories = [];
    var totalExpenses = [];
    var budgetLimits = [];

    {% for summary in category_summaries %}
        categories.push("{{ summary.category.name }}");
        totalExpenses.push({{ summary.total_expense }});
        budgetLimits.push({{ summary.budget_limit }});
    {% endfor %}

    // Chart.js
    var ctx = document.getElementById('budgetChart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: categories,
            datasets: [
                {
                    label: 'Total Expense',
                    data: totalExpenses,
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Budget Limit',
                    data: budgetLimits,
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            title: {
                display: true,
                text: 'Expense vs. Budget',
                fontSize: 18
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
});
</script>


{% endblock %}

{% block scripts %}
<script src="{% static 'js/scripts.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
<script src="assets/demo/chart-area-demo.js"></script>
<script src="assets/demo/chart-bar-demo.js"></script>
{% endblock %}
